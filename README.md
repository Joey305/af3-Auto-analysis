
# AF3 One‑Zip Analyzer

Interactive tool to analyze **AlphaFold 3** ZIP exports (one ZIP at a time), compute **close contacts** between two chains, run **PDBe Arpeggio** (optional) to classify interactions, and generate **plots** + **Residue Interaction Network (RIN)** images.

![Residue Interaction Network](sandbox:/mnt/data/631c18cd-8d5f-47c4-bd08-7884a766f706.png)
*Example RIN generated by the script.*

![Close‑contact atom counts](sandbox:/mnt/data/27a5432b-26f7-4370-a95a-5d6054cd4c59.png)
*Per‑group close‑contact counts within the selected distance threshold.*

---

## Contents

- `Analysis_Script.py` – the menu‑driven analyzer
- `Classes.py` – Atom parser used by the analyzer
- `*.zip` – AlphaFold 3 ZIP(s) you want to analyze

Outputs are written **next to the extracted CIFs**, inside a folder with the same name as your ZIP (without the `.zip`).

---

## Quick start

```bash
# Recommended: create a clean conda env (works on macOS, Linux, Windows)
conda install -n base -c conda-forge mamba  # optional but fast
mamba create -n af3-arpeggio -c conda-forge python=3.11 openbabel biopython gemmi numpy pandas matplotlib networkx tk pip
conda activate af3-arpeggio
pip install pdbe-arpeggio

# Run the analyzer
python Analysis_Script.py
```

You’ll see a menu like:
```
=== AF3 One-Zip Analyzer ===
 1) your_first.zip
 2) your_second.zip
 0) Browse with file dialog
 t) Type/paste a path
 r) Refresh list
 q) Quit
```

Select a ZIP, then follow the prompts run-by-run:
- Pick **interaction type** (Peptide–Protein, Protein–Protein, Ligand–Receptor).
- Script shows **chain stats** from the first CIF so you can assign chains.
- Sensible defaults:
  - Peptide–Protein → **smaller chain** = Peptide, larger = Protein
  - Protein–Protein → largest 2 chains
  - Ligand–Receptor → small HET‑like chain as Ligand if present
- **Rename** the two groups (or keep defaults).
- Set a **distance threshold** (e.g. 5.0 Å).

> Tip: The script asks for a global distance once. For later runs in the same ZIP it will offer to reuse it.

---

## Inputs

- **A single AF3 ZIP** that contains either:
  - one run folder with `fold_*_model_[0-4].cif`, or
  - multiple run folders (e.g. downloading several AF3 jobs at once).

> The script extracts the ZIP to `./<zip_basename>/` and processes each run folder inside it.

---

## Outputs (per CIF / per run)

For each model `fold_<name>_model_N.cif` the script generates:

- `fold_<name>_model_N.pdb` – CIF converted to PDB (for fast parsing)
- `fold_<name>_model_N_close_contacts.pdb` – ATOM/HETATM entries within the chosen distance between the two groups
- `fold_<name>_model_N_close_contacts.cif` – CIF version of the close‑contacts PDB
- `fold_<name>_model_N_contact_plot.png` – bar chart of unique close‑contact atoms per group

If **PDBe Arpeggio** is installed and found, it also writes (filenames are Arpeggio defaults):

- `*_close_contacts.json` – interaction annotations
- `*_close_contacts.csv` – converted by the script for convenience

Run-level summaries:

- `Residue_Interaction_Network_Model_<N>.png` – RIN colored by interaction type
- `interaction_summary_across_models.csv` – per‑pair interaction types across all models in the run

All of these are saved inside the run folder (sibling to the CIFs).

---

## Requirements

Minimum (without Arpeggio typing):

- Python 3.10–3.11
- `biopython` (MMCIFParser, PDBIO)
- `gemmi`
- `numpy`, `pandas`
- `matplotlib`
- `networkx`
- `tk` (for the file dialog)

Optional (to get interaction types via Arpeggio):

- `openbabel` (C++ lib + Python bindings)
- `pdbe-arpeggio` (CLI)

> **Why Python 3.10/3.11?** Open Babel wheels/conda builds usually lag brand‑new Python releases; Python 3.13 may not have working wheels yet.

### Conda (recommended)

```yaml
# environment.yml
name: af3-arpeggio
channels: [conda-forge]
dependencies:
  - python=3.11
  - openbabel
  - biopython
  - gemmi
  - numpy
  - pandas
  - matplotlib
  - networkx
  - tk
  - pip
  - pip:
      - pdbe-arpeggio
```

Create & activate:
```bash
mamba env create -f environment.yml   # or: conda env create -f environment.yml
conda activate af3-arpeggio
```

### Pip (no conda)

This can work, but Open Babel via pip depends on platform availability.

```bash
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate
pip install --upgrade pip

# Core requirements
pip install biopython gemmi numpy pandas matplotlib networkx
# Open Babel (may not exist for newest Python on your OS)
pip install openbabel-wheel
# Arpeggio CLI
pip install pdbe-arpeggio
```

If Open Babel fails to install, you can still use the analyzer (contacts/plots/RIN) by **skipping Arpeggio** – see Troubleshooting.

---

## Troubleshooting

- **`ModuleNotFoundError: No module named 'openbabel'`** when Arpeggio runs  
  Install Open Babel (see Requirements), or use the provided `environment.yml`.  

- **Arpeggio not found / failing**  
  The analyzer continues; you’ll still get close‑contact outputs and RIN.  
  To disable Arpeggio entirely, comment the line:
  ```python
  # run_arpeggio(cc_cif, dp)
  ```

- **Performance** on very large complexes  
  The distance loop is O(N×M). If you want a speed boost, replace it with a KD‑Tree (SciPy’s `cKDTree`). Let me know and I can drop in the fast path.

---

## Export your current environment

If you already have everything working and want to **share your environment**:

- **Conda (portable YAML)**  
  ```bash
  conda env export --no-builds > environment.yml
  ```

- **Pip (requirements.txt)**  
  ```bash
  pip freeze > requirements.txt
  ```
  > Note: `pip freeze` captures *all* packages in the environment. For a minimal set, curate by hand starting from the list in the `Requirements` section.

---

## How it works (high level)

1. **Select ZIP** (menu lists local zips; `0` opens file dialog).  
2. **Extract** to `./<zip_basename>/` preserving sub‑folders.  
3. For each **run folder**:
   - Convert first CIF → PDB and show **chain stats**.
   - Choose **interaction type** and **assign chains** (with defaults).
   - For each model CIF:
     - Convert CIF → PDB
     - Compute **close contacts** between the two selected chains
     - Save `*_close_contacts.pdb/.cif`
     - Plot **contact counts** per group
     - (Optional) Run **Arpeggio** to classify interactions
   - Produce **RIN** and **summary CSV** across models.

That’s it—happy analyzing!
